<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ultimate Chaos Clicker</title>

<!-- PWA meta -->
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#111">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">

<style>
body {
  margin: 0;
  background: #111;
  color: #0f0;
  font-family: 'Courier New', monospace;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: flex-start;
  height: 100vh;
  overflow: hidden;
  transition: background 0.1s;
}
h1 { font-size: 2em; margin-top:10px;}
button {
  padding: 15px 30px;
  margin: 5px;
  font-size: 20px;
  cursor: pointer;
  background: #222;
  border: 2px solid #0f0;
  color: #0f0;
  transition: transform 0.1s, background 0.1s;
}
.upgrade { margin-top: 10px; display:flex; flex-wrap:wrap; justify-content:center; max-width:90%; }
.emoji, .particle {
  position: absolute;
  pointer-events: none;
}
.emoji { font-size: 24px; animation: floatUp 1s linear forwards; }
@keyframes floatUp {
  0% { transform: translateY(0) rotate(0deg); opacity:1;}
  100% { transform: translateY(-150px) rotate(360deg); opacity:0;}
}
.particle { width:5px; height:5px; border-radius:50%; animation: fly 0.5s linear forwards; }
@keyframes fly { 0% { transform: translate(0,0); opacity:1; } 100% { transform: translate(var(--x), var(--y)); opacity:0; } }
.megaClickBtn { position:fixed; bottom:20px; right:20px; font-size:32px; padding:30px 60px; background:#ff0; color:#000; border:3px solid #fff; display:none; z-index:9999;}
#shopPanel { position:fixed; top:50px; right:10px; width:250px; max-height:80%; overflow-y:auto; background:#111; border:2px solid #0f0; padding:10px; display:flex; flex-direction:column; }
#shopPanel h2 { text-align:center; margin:5px 0; }
.shopItem { margin:5px 0; display:flex; justify-content:space-between; align-items:center; }
#chaosMeter {width:90%; max-width:300px;height:20px;background:#222;margin:10px;border:2px solid #0f0;}
#chaosFill {width:0%;height:100%;background:#0f0;}
</style>
</head>
<body>

<h1>Points: <span id="points">0</span></h1>
<div id="chaosMeter"><div id="chaosFill"></div></div>
<button id="clickBtn">CLICK!</button>
<div class="upgrade">
  <button id="autoClickBtn">Buy Auto Clicker (50)</button>
  <button id="multiplierBtn">Double Click Power (100)</button>
  <button id="chaosBtn">Activate Chaos Mode (500)</button>
</div>

<button id="megaClickBtn" class="megaClickBtn">MEGA CLICK!</button>

<div id="shopPanel">
  <h2>Shop</h2>
</div>

<audio id="clickSound" src="click.mp3"></audio>

<script>
// =================== CORE VARIABLES ===================
let points = 0, clickPower = 1, autoClickers = 0, chaos=false;
let comboCount=0, lastClick=0, chaosMeter=0, gravityShift=false;

// =================== DOM ELEMENTS ===================
const pointsDisplay=document.getElementById('points');
const clickBtn=document.getElementById('clickBtn');
const autoClickBtn=document.getElementById('autoClickBtn');
const multiplierBtn=document.getElementById('multiplierBtn');
const chaosBtn=document.getElementById('chaosBtn');
const clickSound=document.getElementById('clickSound');
const chaosFill=document.getElementById('chaosFill');
const megaClickBtn=document.getElementById('megaClickBtn');
const shopPanel=document.getElementById('shopPanel');

// =================== SHOP SYSTEM ===================
let shopItems=[
  {name:"Auto Clicker", basePrice:50, amount:0, multiplier:1.15, effect:()=>autoClickers++},
  {name:"Click Power +1", basePrice:100, amount:0, multiplier:1.2, effect:()=>clickPower++},
  {name:"Chaos Boost", basePrice:200, amount:0, multiplier:1.25, effect:()=>chaosMeter+=10},
  {name:"Mega Click Upgrade", basePrice:500, amount:0, multiplier:1.3, effect:()=>{megaClickBtn.style.display='block';}},
  {name:"Particle Explosion", basePrice:300, amount:0, multiplier:1.2, effect:()=>{}},
  {name:"Combo Boost", basePrice:250, amount:0, multiplier:1.2, effect:()=>{}}
];

function renderShop(){
  shopPanel.innerHTML='<h2>Shop</h2>';
  shopItems.forEach((item,i)=>{
    const price=Math.floor(item.basePrice*Math.pow(item.multiplier,item.amount));
    const div=document.createElement('div');
    div.className='shopItem';
    div.innerHTML=`<span>${item.name} (${item.amount})</span><button onclick="buyItem(${i})">${price} pts</button>`;
    shopPanel.appendChild(div);
  });
}

function buyItem(index){
  const item=shopItems[index];
  const price=Math.floor(item.basePrice*Math.pow(item.multiplier,item.amount));
  if(points>=price){
    points-=price;
    pointsDisplay.textContent=points;
    item.amount++;
    item.effect();
    renderShop();
  }
}

renderShop();

// =================== CHAOS FUNCTIONS ===================
function randomColor(){return `hsl(${Math.floor(Math.random()*360)},100%,50%)`}
function randomOffset(){return (Math.random()-0.5)*200+'px'}
function randomInt(max){return Math.floor(Math.random()*max)}

function spawnEmoji(){
  const emoji=document.createElement('div');
  emoji.className='emoji';
  emoji.textContent=['ðŸ’¥','âš¡','ðŸ”¥','ðŸ’€','ðŸ‘½','ðŸŽµ','ðŸŒ€','âœ¨'][randomInt(8)];
  emoji.style.left=randomInt(window.innerWidth)+'px';
  emoji.style.top=randomInt(window.innerHeight)+'px';
  emoji.style.color=randomColor();
  document.body.appendChild(emoji);
  setTimeout(()=>emoji.remove(),1000);
}

function spawnParticles(x,y,count=10){
  for(let i=0;i<count;i++){
    const p=document.createElement('div');
    p.className='particle';
    p.style.background=randomColor();
    p.style.left=x+'px';
    p.style.top=y+'px';
    let offsetX=randomOffset(), offsetY=randomOffset();
    if(gravityShift) offsetY=-offsetY;
    p.style.setProperty('--x', offsetX);
    p.style.setProperty('--y', offsetY);
    document.body.appendChild(p);
    setTimeout(()=>p.remove(),500);
  }
}

function shakeScreen(intensity=20){
  const x=(Math.random()-0.5)*intensity, y=(Math.random()-0.5)*intensity;
  document.body.style.transform=`translate(${x}px,${y}px)`;
  setTimeout(()=>document.body.style.transform='translate(0,0)',100);
}

function randomEvent(){
  const r=Math.random();
  if(r<0.1){document.body.style.transition='none'; setTimeout(()=>document.body.style.transition='background 0.1s',500);}
  else if(r<0.2){clickPower*=2; setTimeout(()=>clickPower/=2,5000);}
  else if(r<0.35){gravityShift=true; setTimeout(()=>gravityShift=false,5000);}
  else if(r<0.5){document.body.style.filter='invert(1)'; setTimeout(()=>document.body.style.filter='invert(0)',5000);}
}

function updateChaosMeter(amount){
  chaosMeter+=amount;
  if(chaosMeter>100) chaosMeter=100;
  chaosFill.style.width=chaosMeter+'%';
  if(chaosMeter>=100){
    for(let i=0;i<20;i++) spawnParticles(randomInt(window.innerWidth),randomInt(window.innerHeight),20);
    chaosMeter=0; chaosFill.style.width='0%';
  }
}

function showMegaClick(){ if(points>=1000) megaClickBtn.style.display='block'; }

// =================== CLICK HANDLER ===================
clickBtn.onclick=(e)=>{
  const now=Date.now();
  if(now-lastClick<300) comboCount++;
  else comboCount=1;
  lastClick=now;
  points+=clickPower*comboCount;
  pointsDisplay.textContent=points;
  clickBtn.style.transform=`scale(${1+Math.random()*0.3})`;
  clickBtn.style.background=randomColor();
  spawnEmoji(); spawnParticles(e.clientX,e.clientY);
  shakeScreen(); clickSound.currentTime=0; clickSound.play();
  if(chaos) document.body.style.background=randomColor();
  updateChaosMeter(1); showMegaClick(); randomEvent();
  setTimeout(()=>{clickBtn.style.transform='scale(1)';clickBtn.style.background='#222';},100);
};

// =================== MEGA CLICK ===================
megaClickBtn.onclick=()=>{
  points+=500+clickPower*50;
  for(let i=0;i<100;i++){ spawnEmoji(); spawnParticles(randomInt(window.innerWidth),randomInt(window.innerHeight),20);}
  shakeScreen(50); megaClickBtn.style.display='none'; pointsDisplay.textContent=points;
}

// =================== AUTO CLICKERS ===================
setInterval(()=>{
  points+=autoClickers; pointsDisplay.textContent=points;
  for(let i=0;i<autoClickers;i++){ spawnEmoji(); spawnParticles(randomInt(window.innerWidth),randomInt(window.innerHeight),5);}
  if(chaos) document.body.style.background=randomColor();
  randomEvent();
},1000);

// =================== EMOJI BOSS ===================
setInterval(()=>{
  if(Math.random()<0.05){
    const boss=document.createElement('div');
    boss.textContent='ðŸ‘¹';
    boss.style.fontSize='64px'; boss.style.position='absolute';
    boss.style.left=randomInt(window.innerWidth-100)+'px'; boss.style.top=randomInt(window.innerHeight-100)+'px';
    boss.style.cursor='pointer';
    document.body.appendChild(boss);
    boss.onclick=()=>{
      points+=500; pointsDisplay.textContent=points;
      spawnParticles(parseInt(boss.style.left),parseInt(boss.style.top),50);
      boss.remove();
    }
    setTimeout(()=>boss.remove(),10000);
  }
},5000);

// =================== LEADERBOARD ===================
function saveScore(){
  let scores=JSON.parse(localStorage.getItem('chaosLeaderboard')||'[]');
  scores.push(points); scores.sort((a,b)=>b-a); scores=scores.slice(0,5);
  localStorage.setItem('chaosLeaderboard',JSON.stringify(scores));
  console.log('Leaderboard:',scores);
}
window.addEventListener('beforeunload', saveScore);

// =================== SERVICE WORKER ===================
if('serviceWorker' in navigator){
  navigator.serviceWorker.register('sw.js')
  .then(()=>console.log('Service Worker Registered'))
  .catch(err=>console.log('SW registration failed:',err));
}
</script>

</body>
</html>
